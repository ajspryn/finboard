<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Customer Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1>Test Customer Details Modal</h1>
        
        <div class="row">
            <div class="col-md-4">
                <div class="card clickable-metric" onclick="showCustomerDetails('tabungan', 'nominal')" style="cursor: pointer;">
                    <div class="card-body">
                        <h5>Tabungan</h5>
                        <p>Klik untuk lihat detail nasabah</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card clickable-metric" onclick="showCustomerDetails('deposito', 'nominal')" style="cursor: pointer;">
                    <div class="card-body">
                        <h5>Deposito</h5>
                        <p>Klik untuk lihat detail nasabah</p>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card clickable-metric" onclick="showCustomerDetails('pencairan_deposito', 'nominal')" style="cursor: pointer;">
                    <div class="card-body">
                        <h5>Pencairan Deposito</h5>
                        <p>Klik untuk lihat detail nasabah</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal fade customer-modal" id="customerDetailsModal" tabindex="-1" aria-labelledby="customerDetailsModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerDetailsModalTitle">Detail Nasabah</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="customerDetailsModalBody">
                    <!-- Content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function for formatting nominal in JavaScript
        function formatNominal(amount) {
            if (amount >= 1000000000) {
                return 'Rp ' + (amount / 1000000000).toFixed(2) + ' M'; // Miliar
            } else if (amount >= 1000000) {
                return 'Rp ' + (amount / 1000000).toFixed(2) + ' Jt'; // Juta
            } else if (amount >= 100000) {
                return 'Rp ' + (amount / 1000).toFixed(0) + ' Rb'; // Ratusan Ribu
            } else if (amount >= 1000) {
                return 'Rp ' + (amount / 1000).toFixed(1) + ' Rb'; // Ribuan
            } else {
                return 'Rp ' + amount.toFixed(0); // Di bawah ribu
            }
        }

        // Customer Details Modal Functions
        function showCustomerDetails(jenis, type) {
            const modal = new bootstrap.Modal(document.getElementById('customerDetailsModal'));
            const modalTitle = document.getElementById('customerDetailsModalTitle');
            const modalBody = document.getElementById('customerDetailsModalBody');

            // Set modal title
            let title = '';
            switch(jenis) {
                case 'tabungan':
                    title = 'Detail Nasabah Tabungan';
                    break;
                case 'deposito':
                    title = 'Detail Nasabah Deposito';
                    break;
                case 'pencairan_deposito':
                    title = 'Detail Pencairan Deposito';
                    break;
                case 'total_funding':
                    title = 'Detail Total Funding';
                    break;
                default:
                    title = 'Detail Nasabah';
            }
            modalTitle.textContent = title;

            // Show loading
            modalBody.innerHTML = '<div class="text-center py-4"><div class="spinner-border" role="status"></div><br>Loading...</div>';
            modal.show();

            // Fetch customer data
            fetch(`http://127.0.0.1:8000/dashboard/customer-details?jenis=${jenis}&type=${type}&limit=10`)
                .then(response => response.json())
                .then(data => {
                    console.log('API Response:', data);
                    if (data.customers && data.customers.length > 0) {
                        let html = '<div class="table-responsive">';
                        html += '<table class="table table-striped table-hover">';
                        html += '<thead><tr>';
                        html += '<th>No</th>';
                        html += '<th>Nama Nasabah</th>';
                        html += '<th>No Rekening</th>';
                        html += '<th>Nominal</th>';
                        html += '<th>Periode</th>';
                        html += '</tr></thead><tbody>';

                        data.customers.forEach((customer, index) => {
                            html += '<tr class="customer-detail-row">';
                            html += `<td>${index + 1}</td>`;
                            html += `<td>${customer.nama}</td>`;
                            html += `<td>${customer.account}</td>`;
                            html += `<td>${formatNominal(customer.amount)}</td>`;
                            html += `<td>${customer.period}</td>`;
                            html += '</tr>';
                        });

                        html += '</tbody></table>';
                        html += `<div class="mt-3 text-muted">Menampilkan ${data.total} nasabah teratas</div>`;
                        html += '</div>';
                        modalBody.innerHTML = html;
                    } else {
                        modalBody.innerHTML = '<div class="text-center text-muted py-4"><i class="ti ti-info-circle ti-lg mb-2"></i><br>Tidak ada data nasabah</div>';
                    }
                })
                .catch(error => {
                    console.error('Error loading customer details:', error);
                    modalBody.innerHTML = '<div class="text-center text-muted py-4"><i class="ti ti-alert-circle ti-lg mb-2"></i><br>Gagal memuat data nasabah</div>';
                });
        }

        console.log('Test page loaded successfully!');
    </script>
</body>
</html>
