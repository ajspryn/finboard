<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
</head>
<body>
    <h1>Test Dashboard - Trend Produk Funding</h1>
    
    <div class="card">
        <div class="card-header">
            <h5>ðŸ“Š Trend Produk Funding</h5>
            <div class="d-flex gap-2">
                <div class="btn-group">
                    <button id="btnTestChart" class="btn btn-primary">Chart</button>
                    <button id="btnTestTable" class="btn btn-outline-primary">Table</button>
                </div>
                <div class="btn-group">
                    <button id="btnTestNominal" class="btn btn-primary">Nominal</button>
                    <button id="btnTestJumlah" class="btn btn-outline-primary">Jumlah</button>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div id="testChart" style="min-height: 400px;"></div>
        </div>
    </div>

    <script>
        // Mock data
        const fundingTrendData = {
            nominal: {
                tabungan: [1000000000, 1200000000, 1100000000, 1300000000, 1250000000, 1400000000],
                deposito: [500000000, 600000000, 550000000, 650000000, 620000000, 700000000],
                total: [1500000000, 1800000000, 1650000000, 1950000000, 1870000000, 2100000000],
                pencairan: [50000000, 60000000, 55000000, 65000000, 62000000, 70000000]
            },
            jumlah: {
                tabungan: [1000, 1200, 1100, 1300, 1250, 1400],
                deposito: [500, 600, 550, 650, 620, 700],
                total: [1500, 1800, 1650, 1950, 1870, 2100],
                pencairan: [50, 60, 55, 65, 62, 70]
            }
        };

        const fundingTrendLabels = ['Jan 2025', 'Feb 2025', 'Mar 2025', 'Apr 2025', 'Mei 2025', 'Jun 2025'];

        let combinedTrendChart = null;
        const combinedTrendEl = document.querySelector("#testChart");
        let currentCombinedTrendType = 'nominal';
        let currentCombinedTrendView = 'chart';

        function createCombinedTrendView(type = 'nominal', view = 'chart') {
            if (combinedTrendChart) {
                combinedTrendChart.destroy();
            }

            // Mock filter states
            const showTotalTabungan = true;
            const showTotalDeposito = true;
            const showTotalPencairanDeposito = true;

            const series = [];
            const categories = fundingTrendLabels;
            const tableData = [];

            // Initialize table data structure
            const tableRows = {};
            fundingTrendLabels.forEach((month, index) => {
                tableRows[month] = { month: month };
            });

            // Process tabungan data
            if (showTotalTabungan) {
                const totalTabunganData = fundingTrendData[type]['tabungan'];
                series.push({
                    name: type === 'nominal' ? 'Total Tabungan' : 'Jumlah Rekening Tabungan',
                    data: totalTabunganData,
                    type: 'line'
                });
                fundingTrendLabels.forEach((month, index) => {
                    tableRows[month]['Total Tabungan'] = totalTabunganData[index];
                });
            }

            // Process deposito data
            if (showTotalDeposito) {
                const totalDepositoData = fundingTrendData[type]['deposito'];
                series.push({
                    name: type === 'nominal' ? 'Total Deposito' : 'Jumlah Rekening Deposito',
                    data: totalDepositoData,
                    type: 'line'
                });
                fundingTrendLabels.forEach((month, index) => {
                    tableRows[month]['Total Deposito'] = totalDepositoData[index];
                });
            }

            // Process pencairan deposito data
            if (showTotalPencairanDeposito) {
                const pencairanData = fundingTrendData[type]['pencairan'];
                series.push({
                    name: type === 'nominal' ? 'Total Pencairan Deposito' : 'Jumlah Pencairan Deposito',
                    data: pencairanData,
                    type: 'line'
                });
                fundingTrendLabels.forEach((month, index) => {
                    tableRows[month]['Total Pencairan Deposito'] = pencairanData[index];
                });
            }

            // Render based on view type
            if (view === 'table') {
                renderCombinedTrendTable(tableRows, fundingTrendLabels, type);
            } else {
                renderCombinedTrendChart(series, categories, type);
            }
        }

        function renderCombinedTrendChart(series, categories, type) {
            const options = {
                series: series,
                chart: {
                    type: 'line',
                    height: 400,
                    toolbar: { show: true }
                },
                colors: ['#696cff', '#03c3ec', '#fdb528'],
                stroke: { curve: 'smooth', width: 3 },
                markers: { size: 4 },
                xaxis: { categories: categories },
                yaxis: { 
                    title: { text: type === 'nominal' ? 'Nominal (Rp)' : 'Jumlah Rekening' },
                    labels: {
                        formatter: function(value) {
                            if (type === 'nominal') {
                                return 'Rp ' + (value / 1000000).toFixed(0) + 'M';
                            }
                            return value;
                        }
                    }
                },
                tooltip: {
                    y: {
                        formatter: function(value) {
                            if (type === 'nominal') {
                                return 'Rp ' + (value / 1000000).toFixed(2) + ' M';
                            }
                            return value + ' rekening';
                        }
                    }
                },
                legend: { position: 'top', horizontalAlign: 'left' }
            };

            combinedTrendChart = new ApexCharts(combinedTrendEl, options);
            combinedTrendChart.render();
        }

        function renderCombinedTrendTable(tableRows, sortedMonths, type) {
            let html = '<div class="table-responsive"><table class="table table-striped table-hover">';
            html += '<thead><tr><th>Bulan</th>';

            const firstRow = tableRows[sortedMonths[0]];
            Object.keys(firstRow).forEach(key => {
                if (key !== 'month') {
                    html += '<th class="text-end">' + key + '</th>';
                }
            });
            html += '</tr></thead><tbody>';

            sortedMonths.forEach(monthKey => {
                const row = tableRows[monthKey];
                html += '<tr>';
                html += '<td><strong>' + row.month + '</strong></td>';

                Object.keys(row).forEach(key => {
                    if (key !== 'month') {
                        const value = row[key];
                        let displayValue = '';
                        if (type === 'nominal') {
                            displayValue = 'Rp ' + (value / 1000000).toFixed(2) + 'M';
                        } else {
                            displayValue = value.toString();
                        }
                        html += '<td class="text-end">' + displayValue + '</td>';
                    }
                });
                html += '</tr>';
            });

            html += '</tbody></table></div>';
            combinedTrendEl.innerHTML = html;
        }

        // Toggle functions
        window.toggleCombinedTrendView = function(view) {
            currentCombinedTrendView = view;
            document.getElementById('btnTestChart').className = view === 'chart' ? 'btn btn-primary' : 'btn btn-outline-primary';
            document.getElementById('btnTestTable').className = view === 'table' ? 'btn btn-primary' : 'btn btn-outline-primary';
            createCombinedTrendView(currentCombinedTrendType, view);
        };

        window.toggleCombinedTrendChart = function(type) {
            currentCombinedTrendType = type;
            document.getElementById('btnTestNominal').className = type === 'nominal' ? 'btn btn-primary' : 'btn btn-outline-primary';
            document.getElementById('btnTestJumlah').className = type === 'jumlah' ? 'btn btn-primary' : 'btn btn-outline-primary';
            createCombinedTrendView(type, currentCombinedTrendView);
        };

        // Event listeners
        document.getElementById('btnTestChart').addEventListener('click', () => toggleCombinedTrendView('chart'));
        document.getElementById('btnTestTable').addEventListener('click', () => toggleCombinedTrendView('table'));
        document.getElementById('btnTestNominal').addEventListener('click', () => toggleCombinedTrendChart('nominal'));
        document.getElementById('btnTestJumlah').addEventListener('click', () => toggleCombinedTrendChart('jumlah'));

        // Initialize
        createCombinedTrendView('nominal', 'chart');
        
        console.log('Test dashboard loaded successfully!');
    </script>
</body>
</html>
