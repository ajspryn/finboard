<!DOCTYPE html>
<html>
<head>
    <title>Test Customer Details</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1>Test Customer Details Modal</h1>

        <div class="row">
            <div class="col-md-4">
                <button class="btn btn-primary" onclick="showCustomerDetails('tabungan', 'nominal')">
                    Test Tabungan
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-success" onclick="showCustomerDetails('deposito', 'nominal')">
                    Test Deposito
                </button>
            </div>
            <div class="col-md-4">
                <button class="btn btn-warning" onclick="showCustomerDetails('pencairan_deposito', 'nominal')">
                    Test Pencairan Deposito
                </button>
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div class="modal fade customer-modal" id="customerDetailsModal" tabindex="-1" aria-labelledby="customerDetailsModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="customerDetailsModalTitle">Detail Nasabah</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="customerDetailsModalBody">
                    <!-- Content will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Helper function untuk format nominal
        function formatNominal(amount) {
            if (amount >= 1000000000) {
                return 'Rp ' + (amount / 1000000000).toFixed(2) + ' M';
            } else if (amount >= 1000000) {
                return 'Rp ' + (amount / 1000000).toFixed(2) + ' Jt';
            } else if (amount >= 1000) {
                return 'Rp ' + (amount / 1000).toFixed(1) + ' Rb';
            } else {
                return 'Rp ' + amount.toFixed(0);
            }
        }

        // Customer Details Modal Functions
        function showCustomerDetails(jenis, type) {
            console.log('showCustomerDetails called with:', jenis, type);

            const modal = new bootstrap.Modal(document.getElementById('customerDetailsModal'));
            const modalTitle = document.getElementById('customerDetailsModalTitle');
            const modalBody = document.getElementById('customerDetailsModalBody');

            // Set modal title
            let title = '';
            switch(jenis) {
                case 'tabungan':
                    title = 'Detail Nasabah Tabungan';
                    break;
                case 'deposito':
                    title = 'Detail Nasabah Deposito';
                    break;
                case 'pencairan_deposito':
                    title = 'Detail Pencairan Deposito';
                    break;
                case 'total_funding':
                    title = 'Detail Total Funding';
                    break;
                default:
                    title = 'Detail Nasabah';
            }
            modalTitle.textContent = title;
            console.log('Modal title set to:', title);

            // Show loading
            modalBody.innerHTML = '<div class="text-center py-4"><div class="spinner-border" role="status"></div><br>Loading...</div>';
            modal.show();

            // Fetch customer data
            const url = `http://localhost:8000/dashboard/customer-details?jenis=${jenis}&type=${type}&limit=10`;
            console.log('Fetching data from:', url);

            fetch(url)
                .then(response => {
                    console.log('Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('Data received:', data);

                    if (data.customers && data.customers.length > 0) {
                        let html = '<div class="table-responsive">';
                        html += '<table class="table table-striped table-hover">';
                        html += '<thead><tr>';
                        html += '<th>No</th>';
                        html += '<th>Nama Nasabah</th>';
                        html += '<th>No Rekening</th>';
                        html += '<th>Nominal</th>';
                        html += '<th>Periode</th>';
                        html += '</tr></thead><tbody>';

                        data.customers.forEach((customer, index) => {
                            html += '<tr class="customer-detail-row">';
                            html += `<td>${index + 1}</td>`;
                            html += `<td>${customer.nama}</td>`;
                            html += `<td>${customer.account}</td>`;
                            html += `<td>${formatNominal(customer.amount)}</td>`;
                            html += `<td>${customer.period}</td>`;
                            html += '</tr>';
                        });

                        html += '</tbody></table>';
                        html += `<div class="mt-3 text-muted">Menampilkan ${data.total} nasabah teratas</div>`;
                        html += '</div>';

                        modalBody.innerHTML = html;
                    } else {
                        modalBody.innerHTML = '<div class="alert alert-warning">Tidak ada data nasabah ditemukan.</div>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    modalBody.innerHTML = '<div class="alert alert-danger">Terjadi kesalahan saat memuat data.</div>';
                });
        }

        console.log('JavaScript loaded successfully');
    </script>
</body>
</html>